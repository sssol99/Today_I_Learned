# 세마포어 VS 뮤텍스

날짜: 2023년 4월 6일
태그: 운영체제

### 1️⃣ 뮤텍스

- 이진 세마포어

상호 배제를 위한 동기화 도구. cpu가 현재 사용하고 있다는 것을 알리는 자물쇠

<img src='assets/Untitled.png' alt="" />

### 2️⃣ 뮤텍스 락

`자물쇠` 프로세스들이 공유하는 전역 변수 lock

`임계 구역을 잠그는 역할` acquire 함수

프로세스가 임계 구역에 진입하기 전에 호출

`바쁜 대기` (busy waiting) : 썩 좋은 방법은 아님

```java
while(lock==true) 
```

`임계 구역의 잠금을 해제하는 역할` release 함수

임계 구역에서의 작업이 끝나고 호출

<img src='assets/Untitled 1.png' alt="" />

### 3️⃣ 세마포어

<img src='assets/Untitled 2.png' alt="" />

- 좀 더 일반화된 방식의 동기화 도구
- 공유 자원이 여러 개 있는 경우에도 적용 가능

<img src='assets/Untitled 3.png' alt="" />

`사용 가능한 공유 자원의 개수` 전역 변수 S

`임계구역에 들어가도 좋은지, 기다려야되는지 알려주는` wait 함수

```java
wait(){
while(S<=0) // 만익 임계 구역에 진입할 수 있는 프로세스 개수가 0이하라면 
; //사용할 수 있는 자원이 있는지 반복적으로 확인하고
s--; // 임계 구역에 진입할 수 있는 프로세스 개수가 하나 이상이면 S를 1감소시키고 임계 구역 진입
}
```

`임계구역 앞에서 기다리는 프로세스에게 이제 가도 된다고 신호를 주는` signal 함수

```java
signal(){
s++ // 임계 구역에서의 작업을 마친 뒤 S를 1 증가시킴
}
```

### 4️⃣ 세마포어 예제

세 개의 프로세스 1,2,3이 두 개의 공유 자원(S=2)에 p1,p2,p3 순서로 접근한다고 가정해 보자.

1. 1 wait 호출, S 는 현재 2이므로 S를 1 감소시키고 임계 구역 진입
2. 2 wait 호출, S 는 현재 2이므로 S를 1 감소시키고 임계 구역 진입
3. 3 wait 호출, S는 현재 0이므로 무한히 반복하며 S 확인 
4. 1 임계 구역 작업 종료, signal() 호출, S 를 1 증가
5. 3이 S가 1이 됨을 확인, S는 현재 1이므로 S를 1 감소시키고 임계 구역 진입

### 5️⃣ Busy Waiting 해결 방법

1. 사용할 수 있는 자원이 없을 경우 대기 상태(대기 큐에 넣기)로 만듦
2. 사용할 수 있는 자원이 생겼을 경우 대기 큐의 프로세스를 준비 상태로 만듦

<img src='assets/Untitled 4.png' alt="" />

### 6️⃣ 다시 보는 세마포어 예시

1. 1 wait 호출, S 는 현재 2이므로 S를 1 감소시키고 임계 구역 진입
2. 2 wait 호출, S 는 현재 2이므로 S를 1 감소시키고 임계 구역 진입
3. 3 wait 호출, S는 현재 -1이므로 본인의 PCB를 대기 큐에 넣고 대기 상태로 전환
4. 1 임계 구역 작업 종료, signal() 호출, S 를 1 증가하면 0이므로 대기 상태였던 3을 대기 큐에서 꺼내 준비 큐로 옮겨줌
5. 3 임계 구역 진입
6. 2 임계 구역 작업 종료, signal() 호출, S가 1 증가하면 1
7. 3 임계 구역 작업 종료, signal() 호출, S가 1 증가하면 2

### 7️⃣ 세마포어 실행 순서 동기화

p1이 p2보다 반드시 먼저 실행되어야 하는 상황

1. 세마포어 변수 S를 0으로 두고
2. 먼저 실행할 프로세스(p1) 뒤에 signal 함수를
3. 다음에 실행할 프로세스(p2) 앞에 wait 함수를 붙이면 된다

→ 이러면 왜 실행 순서가 보장되나요?

: 다음에 실행할 프로세스는 wait 하니까 먼저 실행할 프로세스가 임계 구역에 진입하게 됨

<img src='assets/Untitled 5.png' alt="" />